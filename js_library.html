<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
    form{
        
    }
    </style>
</head>
<body>
<form action=""></form>
<script type="text/javascript">
    (function(){
    	var fileMap = {};
        var moduleMap = {};
        var readyFun = {};
        var eventName = document.addEventListener ? 'DOMContentLoaded' : 'onreadystatechange';
        document.addEventListener(eventName,function(){
            for(var i in readyFun){
                var funArr = readyFun[i];
                for(var j = 0 , len = funArr.length;j<len;j++){
                    funArr[j]();
                }
            }
        },false);
    	var irouJS = {
    		define:function(name,dependencies,factory){
    			if(!moduleMap[name]){
    				moduleMap[name] = {
    					name:name,
    					dependencies:dependencies,
    					factory:factory
    				};
    			}
    			return moduleMap[name];
    		},
    		use:function(name){
    			var module = moduleMap[name];
    			if(!module){
    				return {};
    			}
    			if(!module.entity){
    				var args = [];
    				for(var i=0,len = module.dependencies.length;i<len;i++){
    					var _dep = module.dependencies[i];
    					if(_dep.entity){
    						args.push(_dep.entity);
    					}else{
    						args.push(this.use(_dep));
    					}
    				};
    				module.entity = module.factory.apply(this,args);
    			}
    			return module.entity;
    		},
            require:function(pathArr,fn){
                for(var i=0,len = pathArr.length;i<len;i++){
                    var path = pathArr[i];
                    loadFile(path);
                }
                function loadFile(path){
                    if(!fileMap[path]){
                        fileMap[path] = true;
                        var head = document.getElementsByTagName('head')[0];
                        var script = document.createElement('script');
                        script.setAttribute('type', 'text/javascript');
                        script.setAttribute('src', path);
                        script.onload = script.onreadystatechange = function(e){
                            if(!this.readyState || (this.readyState == 'loaded') || (this.readyState == 'complete')){
                                head.removeChild(script);
                            }
                            checkAllFile();
                        };
                        head.appendChild(script);
                    }
                };

                function checkAllFile(){
                    var allLoaded = true;
                    for(var i=0,len = pathArr.length;i<len;i++){
                        if(!fileMap[pathArr[i]]){
                            fileMap[pathArr[i]] = true;
                            break;       
                        }
                    }
                    if(allLoaded && fn){
                        fn();
                    }
                };

            },
            ready:function(fn,name){
                name = name ? name : 1;
                if(!readyFun[name]){
                    readyFun[name] = [];
                }
                readyFun[name].push(fn);
            }
    	};
    	window.irouJS = irouJS;
    })();


    irouJS.define('A',[],function(){
    	var obj = {
    		name:'dxm',
    		age:'27'
    	};
    	return obj;
    });
    irouJS.define('B',['A'],function(A){
    	console.log(A);
    	function sayHello(){
    		console.log('hello' + A.name);
    	};
    	return {
    		sayHello : sayHello
    	};
    });

    var b = irouJS.use('B');
    b.sayHello();


    irouJS.require(['http://libs.baidu.com/jquery/1.9.0/jquery.js'],function(){
        console.log($);
    });

    irouJS.ready(function(){
        console.log(1);
    });

    irouJS.ready(function(){
        console.log(2);
    });

</script>
</body>
</html>